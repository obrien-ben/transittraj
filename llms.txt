# transittraj

An R package for reconstructing and visualizing transit vehicle
trajectories.

This is an early development version of `transittraj`. Expect it to
change without warning.

## Introduction

Today’s transit vehicles generate a large amount of automatic vehicle
location (AVL) data. This data is vital in planning and performance
studies, but turning sparse and noisy GPS pings into meaningful
performance metrics is difficult. `transittraj` fills this gap,
integrating with existing open data standards, including GTFS and TIDES,
to provide tools for cleaning AVL data and fitting continuous,
monotonic, invertible, and differentiable trajectory curves. By doing
so, `transittraj` provides versatile and powerful tools to analyze
transit system performance and support decision-making.

You can install the development version of `transittraj` from
[GitHub](https://github.com/) with:

``` r
# install.packages("pak")
pak::pak("UTEL-UIUC/transittraj")
```

## What and Why

The primary goal of `transittraj` is to reconstruct *trajectories* of
transit vehicles from AVL data. A trajectory is a function which
describes the one-dimensional position (i.e., the distance from a trip’s
beginning) of a transit vehicle over time. Vehicle trajectories are
incredibly powerful and versatile tools, and are widely used by traffic
engineers and operations researchers for planning and system performance
studies.

Despite this, there is a gap between transit practice and the field of
trajectory research. Transit practitioners and researchers rarely have
the opportunity to see detailed trajectories of their vehicles, and
instead typically only receive finalized metrics – such as dwell time
and segment-level travel times – from analytics platforms and AVL
providers. If practioners and researchers want a trajectory, they may
look to trajectory research in parallel fields. Transit data is unique,
though, making it difficult to transfer methods. We have both
opportunities and challenges:

- *Opportunities*: Transit vehicles follow a known path; we need not
  worry about lane changing or lateral position, and can measure a
  vehicle’s progress linearly along that path. Additionally, transit has
  standardized data formats, such as [GTFS](https://gtfs.org/) for
  schedule and route alignment, and
  [TIDES](https://tides-transit.org/main/) for vehicle locations.

- *Challenges*: Transit AVL data is sparse, typically pinging every
  15-30 seconds. This is a challenge because the stop-and-go cycles of
  transit vehicles – including stop dwells, signal delays, congestion
  slowdowns, and more – occur with the same frequency as these pings.
  This contrasts much of the research in traffic trajectory
  construction, which has near-continuous data points in free-flow, or
  at least uncongested, traffic conditions.

These challenges inform our general approach to trajectory
reconstruction: use all the data we have to fit an interpolation curve.
This contrasts the smoothing techniques common in other fields, which
may oversmooth the stops and slowdowns transit vehicles experience in
real urban traffic.

There are two main steps to the `transittraj` workflow. The first is AVL
cleaning, where we focus on correcting point observations, such as
infeasible jumps and outliers or backwards drifting during stopping
events. Then, we use position and speed measurements from the cleaned
AVL data to fit a trajectory curve. The trajectory has four important
attributes:

- *Continuous*: There should be no gaps in the trajectory for each trip.

- *Monotonic*: The trajectory should be strictly increasing – transit
  vehicles typically don’t back up in service.

- *Invertible*: If a curve satisfies the previous two points, it will
  also be invertible. This lets us retrieve time as a function of
  distance, incredibly useful if one wants to know when a vehicle passed
  a certain point on its route.

- *Differentiable*: At any point on the curve, we should be able to
  interpolate for the speed of the vehicle. This allows us to generate a
  continuous speed profile of each vehicle’s trip.

![A \`transittraj\` trajectory meeting our four
requirements](reference/figures/README-example_traj.png)

A `transittraj` trajectory meeting our four requirements

`transittraj` aims to make these workflows as smooth and accessible as
possible. We begin with data that adheres to industry standard data
formats, including GTFS and TIDES. In our cleaning and trajectory
fitting, we provide versatile and flexible functions, but avoid
techniques which require complex tuning. Finally, we provide a handful
of helper functions to make it easy to use and visualize your fit
trajectory curves. This website hosts the package’s full documentation,
and includes examples of complete `transittraj` workflows. Check out
some of the vignettes below to get started.

## Getting Started with `transittraj`

Check out the following vignettes to learn more about how to use
`transittraj`:

- [Understanding Data
  Inputs](https://utel-uiuc.github.io/transittraj/articles/input-data.html)

- [The AVL Cleaning
  Workflow](https://utel-uiuc.github.io/transittraj/articles/data-workflow.html)

- [Using
  Trajectories](https://utel-uiuc.github.io/transittraj/articles/intro-trajectories.html)

## Works in Progress

This package is still in early development. In prepartion for an
eventual submission to CRAN, we’re still working on the following:

- Examples in all function documentation

- Sample datasets to include with `transittraj`

- Formal automated testing

- More vignettes

## Citation

`transittraj` is free and open source, but if you find the package
helpful, we’d appreciate a citation:

``` r
utils::citation("transittraj")
#> To cite package 'transittraj' in publications use:
#> 
#>   O'Brien B, Lehe L (2026). _transittraj: Reconstruct and Visualize
#>   Transit Vehicle Trajectories_. R package version 0.0.0.9000, commit
#>   ce1262e5ffde138ec4e1f3708416cda4ab3810bc,
#>   <https://github.com/UTEL-UIUC/transittraj>.
#> 
#> A BibTeX entry for LaTeX users is
#> 
#>   @Manual{,
#>     title = {transittraj: Reconstruct and Visualize Transit Vehicle Trajectories},
#>     author = {Benjamin O'Brien and Lewis Lehe},
#>     year = {2026},
#>     note = {R package version 0.0.0.9000, commit ce1262e5ffde138ec4e1f3708416cda4ab3810bc},
#>     url = {https://github.com/UTEL-UIUC/transittraj},
#>   }
```

# Package index

## GTFS Helpers

Functions to manipulate tidygtfs objects.

- [`filter_by_route()`](https://obrien-ben.github.io/transittraj/reference/filter_by_route.md)
  : Filter GTFS to a desired route(s) and direction(s).
- [`get_shape_geometry()`](https://obrien-ben.github.io/transittraj/reference/get_shape_geometry.md)
  : Get the geometry of a route shape.
- [`project_onto_route()`](https://obrien-ben.github.io/transittraj/reference/project_onto_route.md)
  : Projects points to linear distances along a route shape.
- [`get_stop_distances()`](https://obrien-ben.github.io/transittraj/reference/get_stop_distances.md)
  : Get the distances of stops along routes.
- [`plot_interactive_gtfs()`](https://obrien-ben.github.io/transittraj/reference/plot_interactive_gtfs.md)
  : Generates a Leaflet viewer of GTFS routes and stops.

## AVL Cleaning

Functions to clean AVL data.

- [`get_linear_distances()`](https://obrien-ben.github.io/transittraj/reference/get_linear_distances.md)
  : Linearizes latitude-longitude GPS points to a provided route shape.
- [`clean_overlapping_subtrips()`](https://obrien-ben.github.io/transittraj/reference/clean_overlapping_subtrips.md)
  : Removes trips with multiple overlapping operators or vehicles
  assigned to the same trip number.
- [`clean_jumps()`](https://obrien-ben.github.io/transittraj/reference/clean_jumps.md)
  : Applies median filters to detect large jumps (i.e., outliers) in the
  trajectories.
- [`clean_incomplete_trips()`](https://obrien-ben.github.io/transittraj/reference/clean_incomplete_trips.md)
  : Filters out entire trips which do not meet distance or duration
  requirements.
- [`trim_trips()`](https://obrien-ben.github.io/transittraj/reference/trim_trips.md)
  : Removes observations occurring before a trip's minimum distance, or
  after a trip's maximum distance.
- [`make_monotonic()`](https://obrien-ben.github.io/transittraj/reference/make_monotonic.md)
  : Corrects distance observations, and optionally speeds, to be weakly
  or strictly monotonic.

## Trajectory Construction

Functions to build trajectory objections.

- [`get_trajectory_fun()`](https://obrien-ben.github.io/transittraj/reference/get_trajectory_fun.md)
  : Fits continuous trajectory interpolating curves from transit AVL
  data.
- [`get_gtfs_trajectory_fun()`](https://obrien-ben.github.io/transittraj/reference/get_gtfs_trajectory_fun.md)
  : Fits continuous trajectory interpolating curves from GTFS schedule
  data.

## Trajectory Plotting

Functions to plot trajectories.

- [`plot(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/plot.avltrajectory_group.md)
  [`plot(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/plot.avltrajectory_group.md)
  : \#' Quickly plots an AVL trajectory.
- [`plot_animated_line()`](https://obrien-ben.github.io/transittraj/reference/plot_animated_line.md)
  [`plot_animated_map()`](https://obrien-ben.github.io/transittraj/reference/plot_animated_line.md)
  : Animate vehicle trajectory or AVL data.
- [`plot_trajectory()`](https://obrien-ben.github.io/transittraj/reference/plot_trajectory.md)
  : Plot vehicle trajectories or AVL data.
- [`export_animation()`](https://obrien-ben.github.io/transittraj/reference/export_animation.md)
  : Save your animation at a desired quality.

## Methods for Trajectories

Functions for using trajectories.

- [`predict(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/predict.avltrajectory_group.md)
  [`predict(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/predict.avltrajectory_group.md)
  : Interpolate time or distance points using AVL trajectories.
- [`print(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/print.avltrajectory_group.md)
  [`print(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/print.avltrajectory_group.md)
  : Print function for AVL trajectories
- [`summary(`*`<avltrajectory_group>`*`)`](https://obrien-ben.github.io/transittraj/reference/summary.avltrajectory_group.md)
  [`summary(`*`<avltrajectory_single>`*`)`](https://obrien-ben.github.io/transittraj/reference/summary.avltrajectory_group.md)
  : Summary function for AVL trajectories.

## Data Validation

Functions for validating data.

- [`validate_tides()`](https://obrien-ben.github.io/transittraj/reference/validate_tides.md)
  : Check if an AVL dataframe meets TIDES standards.
- [`validate_monotonicity()`](https://obrien-ben.github.io/transittraj/reference/validate_monotonicity.md)
  : Check if an AVL dataframe satisfies assumptions of monotonicity.

## Supporting Datasets

Datasets to test with.

- [`wmata_avl`](https://obrien-ben.github.io/transittraj/reference/wmata_avl.md)
  : WMATA Bus Automatic Vehicle Location Data
- [`wmata_gtfs`](https://obrien-ben.github.io/transittraj/reference/wmata_gtfs.md)
  : WMATA Bus GTFS

# Articles

### All vignettes

- [The AVL Cleaning
  Workflow](https://obrien-ben.github.io/transittraj/articles/data-workflow.md):
- [Understanding Data
  Inputs](https://obrien-ben.github.io/transittraj/articles/input-data.md):
- [Introduction to
  Trajectories](https://obrien-ben.github.io/transittraj/articles/intro-trajectories.md):
- [Plotting and Visualization Trajectory
  Data](https://obrien-ben.github.io/transittraj/articles/plotting-trajectories.md):
- [Understanding Trajectory
  Objects](https://obrien-ben.github.io/transittraj/articles/trajectory-objects.md):
