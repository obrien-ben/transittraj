<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Interpolate time or distance points using AVL trajectories. — predict.avltrajectory_group • transittraj</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interpolate time or distance points using AVL trajectories. — predict.avltrajectory_group"><meta name="description" content="Using a function stored in a grouped or single trajectory object, new points
will be interpolated along a trajectory. Depending on whether new_times or
new_distances is provided, the function will utilize the direct or inverse
trajectory function."><meta property="og:description" content="Using a function stored in a grouped or single trajectory object, new points
will be interpolated along a trajectory. Depending on whether new_times or
new_distances is provided, the function will utilize the direct or inverse
trajectory function."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">transittraj</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/input-data.html">Input Data</a></li>
    <li><a class="dropdown-item" href="../article/data-workflow.html">AVL Cleaning</a></li>
    <li><a class="dropdown-item" href="../article/trajectories.html">Intro to Trajectories</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/obrien-ben/transittraj/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Interpolate time or distance points using AVL trajectories.</h1>
      <small class="dont-index">Source: <a href="https://github.com/obrien-ben/transittraj/blob/main/R/trajectory_methods.R" class="external-link"><code>R/trajectory_methods.R</code></a></small>
      <div class="d-none name"><code>predict.avltrajectory_group.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Using a function stored in a grouped or single trajectory object, new points
will be interpolated along a trajectory. Depending on whether new_times or
new_distances is provided, the function will utilize the direct or inverse
trajectory function.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="co"># S3 method for class 'avltrajectory_group'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span></span>
<span>  <span class="va">object</span>,</span>
<span>  new_times <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  new_distances <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  deriv <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  trips <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'avltrajectory_single'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, new_times <span class="op">=</span> <span class="cn">NULL</span>, new_distances <span class="op">=</span> <span class="cn">NULL</span>, deriv <span class="op">=</span> <span class="fl">0</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>The single or grouped trajectory object.</p></dd>


<dt id="arg-new-times">new_times<a class="anchor" aria-label="anchor" href="#arg-new-times"></a></dt>
<dd><p>Optional. A vector of numeric timepoints, or a dataframe
with at least the column <code>"event_timestamp"</code> of new timepoints to interpolate
at. Default is <code>NULL</code>.</p></dd>


<dt id="arg-new-distances">new_distances<a class="anchor" aria-label="anchor" href="#arg-new-distances"></a></dt>
<dd><p>Optional. A vector of numeric distances, or a dataframe
with at least the column <code>"distance"</code> of new distances to interpolate at.
Default is <code>NULL</code>.</p></dd>


<dt id="arg-deriv">deriv<a class="anchor" aria-label="anchor" href="#arg-deriv"></a></dt>
<dd><p>Optional. The derivative with which to calculate at. Default is
0.</p></dd>


<dt id="arg-trips">trips<a class="anchor" aria-label="anchor" href="#arg-trips"></a></dt>
<dd><p>Optional. A vector of <code>trip_id_performed</code>s to interpolate for.
Default is <code>NULL</code>, which will use all trips found in the trajectory object.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Other parameters (not used).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>The input dataframe, with an additional column <code>"interp"</code> of the
interpolated values requested, and an additional <code>"trip_id_performed"</code>
column will all trips for which that point is within range.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function is the recommended way to use a fit trajectory function. It has
a few key features:</p><div class="section">
<h3 id="interpolate-for-distance-or-time">Interpolate for Distance or Time<a class="anchor" aria-label="anchor" href="#interpolate-for-distance-or-time"></a></h3>


<p>If <code>new_times</code> is provided, the function will find the <code>distance</code> of each
trip at each new time using the direct trajectory function. Conversely, if
<code>new_distances</code> is provided, the function will find the <code>event_timestamp</code> at
which each trip crossed that distance using the inverse trajectory function.
If an input trajectory object does not contain an inverse function, an error
will be thrown.</p>
<p>These new points can be either vectors or dataframes:</p><ul><li><p>If the input is a vector, the returned value will be a dataframe
associating each trip with each new point and a column <code>interp</code> indicating
the interpolated value.</p></li>
<li><p>If the input is a dataframe, it must contain a column names
<code>event_timestamp</code> or <code>distance</code>, depending on whether it is put into
<code>new_times</code> or <code>new_distances</code>. All other columns will be preserved in the
output. Each row will be duplicated for each trip, and a column <code>interp</code> will
be added indicating the interpolated value.</p></li>
</ul><p>The latter option is particularly useful for finding crossing times of
particular features, or the positions at notable points in time. For
instance, <code>new_distance</code> may be a dataframe of corridors, with a column
<code>name</code> for the corridor name and <code>inout</code> for whether each row is the
entrance or exit to the corridor. The returned value will append the column
<code>trip_id_performed</code> for each trip that crosses those distances, and <code>interp</code>
for the time the trip passes the entrance or exit.</p>
</div>

<div class="section">
<h3 id="finding-derivatives">Finding Derivatives<a class="anchor" aria-label="anchor" href="#finding-derivatives"></a></h3>


<p>Depending on the <code>interp_method</code> used when fitting the trajectory object, a
its derivative may be able to be found:</p><ul><li><p><code>interp_method = "linear"</code>. This will not allow derivatives. This is
because, at each observation, the piecewise linear function is not
differentiable.</p></li>
<li><p><code>interp_method</code> is a spline from <code><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">stats::splinefun()</a></code>. This will typically
be differentiable up to the third degree.</p></li>
</ul><p>The derivative returned (as column <code>interp</code>) is the derivative of distance
with respect to time. This means the first derivative is velocity, second is
acceleration, and third is jerk. The derivative is taken from the direct
trajectory, not the inverse, and the inverse trajectory cannot be used to
find derivatives. This means that if <code>new_distances</code> is provided, <code>deriv </code>
must equal 0. If starting from distance values, but derivatives are desired,
consider interpolating for timepoints first, then using these as <code>new_times</code>
to find the derivative.</p>
</div>

<div class="section">
<h3 id="prevents-extrapolation">Prevents Extrapolation<a class="anchor" aria-label="anchor" href="#prevents-extrapolation"></a></h3>


<p>By default, many fit interpolating curves will allow extrapolation (i.e.,
the input of an <code>event_timestamp</code> beyond the original time domain of the
trip). This is especially true for splines fit using <code><a href="https://rdrr.io/r/stats/splinefun.html" class="external-link">stats::splinefun()</a></code>.
In general, this will not be reasonable for transit vehicles: time points
should be constrained by the time that a trip has actually been observed,
and distances should be constrained to the part of a route a trip actually
ran.</p>
<p>This function uses the maximum and minimum time and distance values stored
in the trajectory object to identify if an input <code>new_times</code> or
<code>new_distances</code> is beyond the domain/range of each trip individually. The
returned output will only include <code>interp</code> values for trips within the
domain/range of the input.</p>
</div>

<div class="section">
<h3 id="accessing-the-raw-trajectory-function">Accessing the Raw Trajectory Function<a class="anchor" aria-label="anchor" href="#accessing-the-raw-trajectory-function"></a></h3>


<p>Because of the above features and protections, it is recommend that these
<code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code> functions are used to access the fit trajectory and inverse
trajectory functions. However, if the raw function itself is desired,
it can be accessed using <code>attr(trajectory, "traj_fun")</code> or
<code>attr(trajectory, "inv_traj_fun")</code>. For a group trajectory object, these
will return lists of individual trip functions indexed by
<code>trip_id_performed</code>; for single trajectory objects, these will return the
single function for that trip.</p>
</div>

    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin O’Brien, Lewis Lehe.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

