% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/trajectory_visualization.R
\name{plot_animated_map}
\alias{plot_animated_map}
\title{Generate an animated vehicle map along a route's alignment.}
\usage{
plot_animated_map(
  route_geom,
  trajectory = NULL,
  distance_df = NULL,
  plot_trips = NULL,
  timestep = 5,
  distance_lim = NULL,
  center_vehicles = FALSE,
  feature_distances = NULL,
  background = "cartolight",
  background_zoom = 0,
  bbox_expand = NULL,
  transition_style = "linear",
  route_color = "coral",
  route_width = 3,
  route_alpha = 1,
  feature_shape = 21,
  feature_outline = "black",
  feature_fill = "white",
  feature_size = 2,
  feature_stroke = 1.25,
  feature_alpha = 1,
  veh_shape = 23,
  veh_outline = "grey30",
  veh_fill = "white",
  veh_size = 3,
  veh_stroke = 2,
  veh_alpha = 0.8,
  label_field = NULL,
  label_size = 3,
  label_alpha = 0.6,
  label_pos = "out"
)
}
\arguments{
\item{route_geom}{An SF linestring object for a single route shape. Ideally, should be the shape used to initially linearize trajectories or stop distances. The CRS of route_geom will be used for the entire map.}

\item{trajectory}{Optional. A trajectory object, either a single trajectory or grouped trajectory. If provided, distance_df must not be provided. Default is NULL.}

\item{distance_df}{Optional. A dataframe of time and distance points. Must include at least "event_timestamp" and numeric "distance". If provided, trajectory must not be provided. Default is NULL.}

\item{plot_trips}{Optional. A vector of trip IDs to plot. Default is NULL, which will plot all trips provided in the trajectory object or distance_df.}

\item{timestep}{Optional. If a trajectory is provided, the time interval, in seconds, between interpolated observations to plot. Default is 5.}

\item{distance_lim}{Optional. A vector with (minimum, maximum) distance values to plot.}

\item{center_vehicles}{Optional. A boolean, should all vehicle points be centered to start at the same time (0 seconds)? Default is FALSE.}

\item{feature_distances}{Optional. A dataframe with at least numeric "distance" for features. Default is NULL.}

\item{background}{Optional. The OSM background (basemap) for the animation. See 'rosm::osm.image()'. Default is "cartolight".}

\item{background_zoom}{Optional. The zoom, relative to the "correct" level, for the background basemap. Default is 0, which will use the zoom most appropriate for the input spatial data. Entering a negative number will yield a lower resolution, "zoomed out" basemap, substantially speeding up rendering.}

\item{bbox_expand}{Optional. The distance, in the units of the route_geom CRS (e.g., meters if UTM), by which to expand the plotting window in both directions. Default is NULL, which will expand the window by 0.05\% of the larger dimension (or 0.0025\% if distance_lim is provided).}

\item{transition_style}{Optional. A gganimate transition style, specifying how individual points are animated between. Default is "linear".}

\item{route_color}{Optional. A color string for the color of the background route. Default is "coral".}

\item{route_width}{Optional. A numeric, the linewidth of the background route. Default is 3.}

\item{route_alpha}{Optional. A numeric, the opacity of the background route. Default is 1.}

\item{feature_shape}{Optional. A numeric specifying the ggplot2 point shape, or a dataframe mapping an attribute in feature_distances to a shape. Must contain column "shape". Default is 21 (circle).}

\item{feature_outline}{Optional. A color string, or a dataframe mapping an attribute in feature_distances to a color. Must contain column "outline". Default is "black".}

\item{feature_fill}{Optional. A color string, the inside fill of feature points. Default is "white".}

\item{feature_size}{Optional. A numeric, the size of the feature point. Default is 2.}

\item{feature_stroke}{Optional. A numeric, the linewidth of the feature point outline. Default is 1.25.}

\item{feature_alpha}{Optional. A numeric, the opacity of the feature point Default is 1.}

\item{veh_shape}{Optional. A numeric specifying the ggplot2 point shape, or a dataframe mapping an attribute in distance_df or the trajectory object to a shape. Must contain column "shape". Default is 23 (diamond).}

\item{veh_outline}{Optional. A color string, or a dataframe mapping an attribute in distance_df or the trajectory object to a color. Must contain column "outline". Default is "grey30".}

\item{veh_fill}{Optional. A color string, the inside fill of the vehicle point. Default is "white".}

\item{veh_size}{Optional. A numeric, the size of the vehicle point. Default is 3.}

\item{veh_stroke}{Optional. A numeric, the linewidth of the vehicle point outline. Default is 2.}

\item{veh_alpha}{Optional. A numeric, the opacity of the feature point Default is 0.8.}

\item{label_field}{Optional. A string specifying the column in feature_distances with which to label the feature lines. Default is NULL, where no labels will be plotted.}

\item{label_size}{Optional. The font size of the feature labels. Default is 3.}

\item{label_alpha}{Optional. The opacity of the feature labels. Default is 0.6.}

\item{label_pos}{Optional. A string specifying the label position on the graph. Must be an abbreviated cardinal or intermediate direction (e.g., "N", "SW", etc.), or "in" or "out". Default is "out".}
}
\value{
A gganimate object.
}
\description{
This function generates a spatial plot of a route's alignment, as animates vehicles moving along this alignment.
This function is designed to work with linearized distances, not raw GPS points. Linear distances are spatialized using the input route_geom.
If a trajectory object is provided, the interpolating function(s) will be plotted at the desired temporal resolution. If a distance_df is provided, the points will be plotted.
Optionally, spatial "features" can be added as points along the route line. These may be stations, traffic signals, etc.
As with the trajectories, these features should be linearized (i.e., the distance along the route at which the feature occurs), not spatial. These distances are spatialized using the input route_geom.
Optionally, a label may be added to these features.
The outline colors and shapes of both vehicles and features can be mapped to their respective attributes.
If using this attribute mapping, provide a dataframe with at least the columns "outline" or "shape", plus only one column matching a column in distance_df or feature_distances. If using a trajectory object, only "trip_id_performed" can be mapped to.
Feature labels will automatically match the colors of features.
A gganimate object is returned, which can be further modified and customized as desired.
}
